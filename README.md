# vaccine-reservation-program
# 백신예약 홈페이지 만들기
## 설치 프로그램
### 1. 오라클 11g 설치 (설치파일 있음)
### 2. 톰캣 8.0 설치
구글에 톰캣 검색 후 절차대로 진행하여 설치

![image](https://user-images.githubusercontent.com/104752580/234200374-175d9f33-308f-4d51-ae8a-ebbabf31c4ad.png)
![image](https://user-images.githubusercontent.com/104752580/234200539-b1dc4860-3b4a-45f1-8e2c-57e8654efb82.png)
### 3. jdbc 6 설치 (설치파일 있음)
### 4. jdk,jre 1.8.0_191 설치
www.oracle.com/java/technologies 사이트 접속 후 절차대로 진행하여 설치

![image](https://user-images.githubusercontent.com/104752580/234199922-e92b09f8-36f9-491f-b079-ad1c2980a091.png)
![image](https://user-images.githubusercontent.com/104752580/234200039-e55fe9ba-2f52-4aa5-ba22-0ac743050a7a.png)
### 5. 이클립스 설치
구글에 이클립스 다운로드 검색 후 절차대로 진행하여 설치

![image](https://user-images.githubusercontent.com/104752580/234200954-031485e3-2410-4310-91ef-1631e2e1cef4.png)
![image](https://user-images.githubusercontent.com/104752580/234200994-6869331d-2410-4673-a37f-bca4fef76bd3.png)
![image](https://user-images.githubusercontent.com/104752580/234201046-498fb334-119d-4c7c-8529-49d76dd471d0.png)

## 환경 세팅
### 1. 바탕화면에 새 폴더 생성
![image](https://user-images.githubusercontent.com/104752580/234201345-9043f0f6-33c5-42e1-8f3e-3afc1b66ff25.png)
### 2. 새폴더를 이클립스 브라우저로 설정
![image](https://user-images.githubusercontent.com/104752580/234201730-f638163e-6f93-4f3a-a100-0e298000cddd.png)
### 3. 데이터베이스 오라클 연결
![image](https://user-images.githubusercontent.com/104752580/234202055-2f404622-a344-48ea-a77d-6a35afa0ac88.png)
![image](https://user-images.githubusercontent.com/104752580/234202142-0a77da43-43ec-4a8f-b1ae-aaa0acd8e379.png)
![image](https://user-images.githubusercontent.com/104752580/234202210-b5729915-e648-46af-855c-6fb8dfccdb21.png)
![image](https://user-images.githubusercontent.com/104752580/234202302-8d9a7e5d-7271-4f48-bcdf-c633e4fc9955.png)
![image](https://user-images.githubusercontent.com/104752580/234202387-b95535d1-5831-47a3-8e45-6ce4a9c10296.png)

jdbc 6 버전을 찾아넣기

![image](https://user-images.githubusercontent.com/104752580/234202552-98a94ae8-04ef-4854-a897-8b1306c44f9c.png)
![image](https://user-images.githubusercontent.com/104752580/234202897-ffac6fd0-c23d-4fa1-ae90-4f1c4a87fb1b.png)

ping succeed가 뜨면 finish
### 4. 프로젝트 생성전에 utf-8로 설정하기
![image](https://user-images.githubusercontent.com/104752580/234203435-3807c617-8cf2-45df-82e1-5ba853851c47.png)
![image](https://user-images.githubusercontent.com/104752580/234203516-477310cd-b806-4617-bebf-acffdfd258c8.png)
![image](https://user-images.githubusercontent.com/104752580/234203623-7b4ecc90-272c-4bed-9347-9c2ec964335d.png)

css,html,jsp 파일 모두 utf-8로 설정하고 apply and close를 누른다.

### 5. 프로젝트 생성
![image](https://user-images.githubusercontent.com/104752580/234203922-8f33760b-02b2-4ae3-a583-070b3fb6612b.png)
![image](https://user-images.githubusercontent.com/104752580/234204012-4647ec16-ced4-4684-90a0-ee78c36b14bf.png)
![image](https://user-images.githubusercontent.com/104752580/234204219-9111ba3f-3ce2-42c3-aeae-61e19696c3ca.png)
![image](https://user-images.githubusercontent.com/104752580/234204360-947d166e-ed11-4a1b-8b81-261253970e7c.png)
![image](https://user-images.githubusercontent.com/104752580/234204628-a120dd73-1174-49bb-92d5-b7ed9df13104.png)

톰캣이 있는 폴더의 경로를 찾아넣기

### 6. jsp에서 db연결
![image](https://user-images.githubusercontent.com/104752580/234204939-94ca967c-4ad1-4e91-b53f-cbbffb9db068.png)
![image](https://user-images.githubusercontent.com/104752580/234205235-25388232-c4ba-4304-8ed1-13f14b0014b1.png)
![image](https://user-images.githubusercontent.com/104752580/234205371-257060fc-d3f6-4f0f-94b7-1d6adb3979b3.png)

jdbc 6 버전을 찾아넣기

![image](https://user-images.githubusercontent.com/104752580/234205564-b9b9239e-4c10-46a3-9a30-8e54ef906391.png)
![image](https://user-images.githubusercontent.com/104752580/234205662-d29f6d56-1c89-44c5-8f53-407b6b20867f.png)
![image](https://user-images.githubusercontent.com/104752580/234205773-d7c4ff90-38d8-4b45-b1eb-9ebd1b08dce1.png)
![image](https://user-images.githubusercontent.com/104752580/234205853-e56d8b58-8b03-4a41-95e5-801202c6193a.png)
![image](https://user-images.githubusercontent.com/104752580/234207489-8979b3c5-23eb-42f3-a743-0eb2ab3559df.png)

입력
## 홈페이지 제작
![image](https://user-images.githubusercontent.com/104752580/234481911-e188a0fe-dfa7-4113-ab6f-ded30eab6842.png)

webapp 폴더 안에 jsp파일, sql파일, css 파일을 만들어 줍니다.

jsp 파일은 미리 다 만들어 놓는것이 편합니다.

jsp 파일을 다 만든 후 파일 마다 css 연결 태그를 작성해줍니다. 

연결 태그는 외우는게 제일 편리합니다.

![image](https://user-images.githubusercontent.com/104752580/234483026-cc5a0223-e254-4920-8f05-483d0e05b6a8.png)

이제 홈페이지의 메인 화면부터 만듭니다.

![image](https://user-images.githubusercontent.com/104752580/234483634-e8ed88af-394c-481b-be0d-416187ac0d32.png)

### 1. header.jsp
먼저 헤더 에는 (과정평가형 정보처리산업기사) 백신예약 프로그램 ver 202109를 제목 태그로 만들어야 합니다.

css를 사용하기 위해서 미리 class를 설정해 두는게 좋습니다.

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<link rel = "stylesheet" href = "style.css?abc">
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<header class = "header">
<%-- h1이라는 제목 태그에 글을 작성한다. --%> 
<h1>(과정평가형 정보처리산업기사) 백신예약 프로그램 ver 202109</h1>
</header>
</body>
</html>
```
### 2. nav.jsp
nav 페이지에는 백신예약, 백신예약조회, 백신예약현황, 홈으로 4개에 링크가 있는 목록태그를 만들어야 합니다.

이때 링크는 자신이 만들 페이지로 걸어두어야 합니다.

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<link rel = "stylesheet" href = "style.css?abc">
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<nav class = "nav">
<%-- 전체목록태그 ul 안에 li, a(링크태그) 태그를 이용하여 하나씩 링크가 있는 목록으로 생성해준다.   --%>
<ul>
<li><a href="vr.jsp">백신예약</a></li>
<li><a href="vrj.jsp">백신예약조회</a></li>
<li><a href="vrh.jsp">백신예약현황</a></li>
<li><a href="index.jsp">홈으로</a></li>
</ul>
</nav>
</body>
</html>
```
### 3. section.jsp

section 페이지에는 아무것도 없기 때문에 클래스만 만들어 놓습니다.

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<link rel = "stylesheet" href = "style.css?abc">
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<section class = "section">

</section>
</body>
</html>
```
### 4. footer.jsp

footer 페이지에는 HRDKOREA Copyrightc2015 All rights reserved. Human Resources Development Service of Korea를 입력해줍니다.

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<link rel = "stylesheet" href = "style.css?abc">
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<footer class = "footer">
<%-- p태그로 글을 작성한다. --%>
<p>HRDKOREA Copyrightc2015 All rights reserved. Human Resources Development Service of Korea</p>
</footer>
</body>
</html>
```

### 5. index.jsp
이제 index.jsp 페이지에 include 액션태그를 사용하여 header.jsp, nav.jsp, section.jsp, footer.jsp 4개의 파일들을 불러드립니다.

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<link rel = "stylesheet" href = "style.css?abc">
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<%-- include를 이용하여 페이지를 복사해옴. --%>
<header>
<jsp:include page="header.jsp"></jsp:include>
</header>
<nav>
<jsp:include page="nav.jsp"></jsp:include>
</nav>
<section>
<jsp:include page="section.jsp"></jsp:include>
</section>
<footer>
<jsp:include page="footer.jsp"></jsp:include>
</footer>
</body>
</html>
```

메인 페이지를 완성했으면 sql를 만듭니다.

![image](https://user-images.githubusercontent.com/104752580/234488558-a40728ee-9a5e-4df9-a730-d49b72db83db.png)

### 6. sql.sql
테이블 3개를 만듭니다.

```sql
create table TBL_JUMIN_202108(
JUMIN VARCHAR2(20) NOT NULL PRIMARY KEY,
NAME VARCHAR2(15),
PHONE VARCHAR2(15),
ADDRESS VARCHAR2(50)
);

insert INTO TBL_JUMIN_202108 values('710101-1000001','김주민','010-1111-1111','경기도 성남시 수정구 태평1동');
insert INTO TBL_JUMIN_202108 values('720101-2000001','이주민','010-1111-2222','경기도 성남시 수정구 태평2동');
insert INTO TBL_JUMIN_202108 values('730101-1000001','박주민','010-1111-3333','경기도 성남시 수정구 복정동');
insert INTO TBL_JUMIN_202108 values('740101-2000001','홍주민','010-1111-4444','경기도 성남시 수정구 산성동');
insert INTO TBL_JUMIN_202108 values('750101-1000001','조주민','010-1111-5555','경기도 성남시 중원구 성남동');
insert INTO TBL_JUMIN_202108 values('760101-2000001','최주민','010-1111-6666','경기도 성남시 중원구 중앙동');
insert INTO TBL_JUMIN_202108 values('770101-1000001','장주민','010-1111-7777','경기도 성남시 중원구 상대원동');
insert INTO TBL_JUMIN_202108 values('780101-2000001','정주민','010-1111-8888','경기도 성남시 중원구 하대원동');
insert INTO TBL_JUMIN_202108 values('790101-1000001','강주민','010-1111-9999','경기도 성남시 분당구 야탑1동');
insert INTO TBL_JUMIN_202108 values('800101-2000001','신주민','010-2222-1111','경기도 성남시 분당구 야탑2동');

create table TBL_HOSP_202108(
HOSPCODE CHAR(4) NOT NULL PRIMARY KEY,
HOSPNAME VARCHAR2(40),
HOSPTEL VARCHAR2(15),
HOSPADDR VARCHAR2(50)
);

insert into TBL_HOSP_202108 values('H001','가_병원','031-1111-2222','10');
insert into TBL_HOSP_202108 values('H002','나_병원','031-1111-3333','20');
insert into TBL_HOSP_202108 values('H003','다_병원','031-1111-4444','30');
insert into TBL_HOSP_202108 values('H004','라_병원','031-1111-5555','40');

create table TBL_VACCRESV_202108(
RESVNO NUMBER(8) NOT NULL PRIMARY KEY,
JUMIN VARCHAR2(20),
HOSPCODE CHAR(4),
RESVDATE DATE,
RESVTIME NUMBER(4),
VCODE CHAR(4)
);


INSERT INTO TBL_VACCRESV_202108 VALUES(20210001,'710101-1000001','H001','20210801',0930,'V001');
INSERT INTO TBL_VACCRESV_202108 VALUES(20210002,'720101-2000001','H002','20210801',1030,'V002');
INSERT INTO TBL_VACCRESV_202108 VALUES(20210003,'730101-1000001','H003','20210801',1130,'V003');
INSERT INTO TBL_VACCRESV_202108 VALUES(20210004,'740101-2000001','H001','20210801',1230,'V001');
INSERT INTO TBL_VACCRESV_202108 VALUES(20210005,'750101-1000001','H001','20210801',1330,'V002');
INSERT INTO TBL_VACCRESV_202108 VALUES(20210006,'760101-2000001','H002','20210801',1430,'V003');
INSERT INTO TBL_VACCRESV_202108 VALUES(20210007,'770101-1000001','H003','20210801',1530,'V001');
INSERT INTO TBL_VACCRESV_202108 VALUES(20210008,'780101-2000001','H001','20210801',1630,'V002');
INSERT INTO TBL_VACCRESV_202108 VALUES(20210009,'790101-1000001','H001','20210801',1730,'V003');
INSERT INTO TBL_VACCRESV_202108 VALUES(20210010,'800101-2000001','H002','20210801',1830,'V001');
```

sql을 다 작성했다면 밴식 예약 페이지를 만듭니다.

백신 예약 페이지는 입력하는 페이지와 입력 받는 페이지 두개가 필요합니다.

조건에 맞게 페이지를 만들어야 합니다.

![image](https://user-images.githubusercontent.com/104752580/234487373-c8fe6aed-b1d1-4394-a877-daca785f6574.png)

### 7. vr.jsp
html 태그를 이용하여 테이블을 만듭니다.

예약번호 자동완성, 수정불가를 하기 위해서는 readonly(읽기전용)와 sql 쿼리문 필요합니다.

백신코드는 셀렉트 박스로 만들고, 병원코드는 라디오버튼으로 만듭니다.

예약날짜와 예약시간을 yyyymmdd와 hh:mm으로 지정하기 위해서는 sql 쿼리문이 필요합니다.

유효성 검사를 위해 스크립트문도 작성해야합니다.

vr_p.jsp 페이지와 연동하기 위해서 form를 사용해야 합니다.
```jsp
<%-- 페이지를 DB와 연결시킴 --%>
<%@ page import="DB.DBConnect" %>
<%-- sql에 모든 라이브러리를 가져옴 --%>
<%@ page import="java.sql.*" %>
<%-- 페이지의 코드 타입은 html로 설정하고 문자 코드는 utf-8로 설정함 --%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%
	// 쿼리문 조회 한다. 
	String sql = "select max(RESVNO) from TBL_VACCRESV_202108";
	// DB 연결
	Connection conn = DBConnect.getConnection();
	PreparedStatement pstmt = conn.prepareStatement(sql);
	ResultSet rs = pstmt.executeQuery();
	// 데이터에서 첫번째행에서 마지막 행까지를 추출
	rs.next();
	// num 값을 데이터 1번에 값에 1를 더해준 값으로 지정한다.
	int num = rs.getInt(1)+1;

%>
<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href = "style.css?abc">
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
// 유효성 검사 코드 
function checkVal() {
	// 값이 입력되지 않았을 때 입력하라고 문구를 띄워준 후 입력해야하는 값에 포커스가 이동한다.
	if(!document.data.rno.value){
		alert("예약번호를 입력하세요.");
		data.rno.focus();
		return false;
	}else if(!document.data.jno.value){
		alert("주민번호를 입력하세요.");
		data.jno.focus();
		return false;
	}else if(!document.data.vcode.value){
		alert("백신코드를 입력하세요.");
		return false;
	}else if(!document.data.hcode.value){
		alert("병원코드를 입력하세요.");
		return false;
	}else if(!document.data.rdate.value){
		alert("예약날짜를 입력하세요.");
		data.rdate.focus();
		return false;
	}else if(!document.data.rtime.value){
		alert("예약시간를 입력하세요.");
		data.rtime.focus();
		return false;
	}
	
}
	


</script>
</head>
<body>
<header>
<jsp:include page="header.jsp"></jsp:include>
</header>
<nav>
<jsp:include page="nav.jsp"></jsp:include>
</nav>
<section class = "section">
<%-- submit 버튼을 입력했을 때 action 값으로 이동 시켜주고 checkVal() 함수를 리터한다. --%>
<form name = "data" method="post" action="vr_p.jsp" onsubmit="return checkVal()">
<h1>백신 예약</h1>
<table class = "table">
<tr>
<td>예약번호</td>
<%-- 예약번호 입력값에 num 값을 자동으로 반환하고 수정이 불가하도록 만들었다. --%>
<td><input type = "text" name = "rno" value="<%= num %>" readonly> 예)20210011</td>
</tr>
<tr>
<td>주민번호</td>
<td><input type = "text" name = "jno"> 예)790101-1111111</td>
</tr>
<tr>
<td>백신코드</td>
<%-- 백신코드는 셀렉트 박스로 만들었다. --%>
<td><select name = "vcode">
<option value = "">백신선택</option>
<option value = "V001">A백신</option>
<option value = "V002">B백신</option>
<option value = "V003">C백신</option>
</select> 예)V001, V002, V003</td>
</tr>
<tr>
<td>병원코드</td>
<%-- 병원코드는 라이오 박스로 만들었다.  --%>
<td><input type ="radio" name = "hcode" value ="H001">가_병원
<input type ="radio" name = "hcode" value ="H002">나_병원
<input type ="radio" name = "hcode" value ="H003">다_병원
<input type ="radio" name = "hcode" value ="H004">라_병원
 예)H001, H002, H003, H004</td>
</tr>
<tr>
<td>예약날짜</td>
<td><input type = "text" name = "rdate"> 예)20210101</td>
</tr>
<tr>
<td>예약시간</td>
<td><input type = "text" name = "rtime"> 예)0903,1130</td>
</tr>
<tr>
<td colspan="2" align="center">
<input type = "submit" value="등록">
<%-- 리셋 타입을 통해 버튼을 누르면 테이블의 데이터가 초기화 되게 만들었다. --%>
<input type = "reset" value="취소">
</td>
</tr>
</table>
</form>
</section>
<footer>
<jsp:include page="footer.jsp"></jsp:include>
</footer>
</body>
</html>
```

입력 페이지를 만들었으면 받는 페이지를 작성합니다.
#### 8. vr_p.jsp
입력된 값을 받는 페이지이기 때문에 insert문을 사용합니다.

```jsp
<%@ page import="DB.DBConnect" %>
<%@ page import="java.sql.*" %>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%

	// vr.jsp에서 입력한 데이터 값을 백신 예약 테이블에 넣어준다. 
	String sql = "insert into TBL_VACCRESV_202108 values(?,?,?,?,?,?)";

	Connection conn = DBConnect.getConnection();
	PreparedStatement pstmt = conn.prepareStatement(sql);
	// String형으로 받아와서 parameter 값으로 넣어준다.
	pstmt.setString(1, request.getParameter("rno"));
	pstmt.setString(2, request.getParameter("jno"));
	pstmt.setString(3, request.getParameter("hcode"));
	pstmt.setString(4, request.getParameter("rdate"));
	pstmt.setString(5, request.getParameter("rtime"));
	pstmt.setString(6, request.getParameter("vcode"));
	
	pstmt.executeUpdate();
	
%>   
 
<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href = "style.css?abc">
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<%-- index 페이지로 이동시킨다. --%>
<jsp:forward page="index.jsp"></jsp:forward>
</body>
</html>
```

백신 예약 페이지를 완성했으면 백신예약조회 페이지를 만듭니다.

예약조회 페이지도 조회 결과 페이지도 만들어야 하기 때문에 페이지 두개를 만듭니다.

![image](https://user-images.githubusercontent.com/104752580/234490725-31b90436-dad0-418f-9d03-4bba2470a346.png)

### 9. vrj.jsp

조회하는 페이지는 결과 페이지와 연동하고, 유효성 검사와 홈으로 이동하기 때문에 form 태그, 스트립트 문, onclick을 사용해야 합니다.

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href = "style.css?abc">
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
function checkVal2() {
	if(!document.data2.rno.value){
		alert("예약번호를 입력하세요.");
		data2.rno.focus();
		return false;
	}
	return true;
}
</script>
</head>
<body>
<header>
<jsp:include page="header.jsp"></jsp:include>
</header>
<nav>
<jsp:include page="nav.jsp"></jsp:include>
</nav>
<section class = "section">
<form name= "data2" method="post" action="vrj_p.jsp" onsubmit="return checkVal2()">
<h1>백신 예약 조회</h1>
<table class = "table">
<tr>
<td>예약번호</td>
<td><input type="text" name = "rno"></td>
</tr>
<tr>
<td colspan="2" align="center">
<input type="submit" value="조회하기">
<%-- onclick을 통해서 버튼을 누르면 index 페이지로 이동하게 한다. --%>
<input type="button" value="홈으로"  onclick="location.href='index.jsp'">
</table>
</form>
</section>
<footer>
<jsp:include page="footer.jsp"></jsp:include>
</footer>
</body>
</html>
```

 이제 결과 페이지를 만듭니다.
 
### 10. vrj_p.jsp
결과 페이지에는 예약번호가 주민으로 되어있는 번호면 예약번호, 성명, 성별, 병원이름, 예약날짜, 예약시간, 백신코드, 병원지역을 sql에서 가져옵니다.

하지만, 예약번호가 없는 번호라면 결과가 없다는 페이지가 만들어져야합니다.

조건이 만족하기 위해서는 sql 쿼리문과 if/else문을 사용해야 합니다.

```jsp
<%@ page import="DB.DBConnect" %>
<%@ page import="java.sql.*" %>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%
	// reno를 rno로 지정함
 	int reno = Integer.parseInt(request.getParameter("rno"));
	// StringBuffer를 통해서 문자열을 추가하거나 변경 할 준비를 한다.
	StringBuffer sb = new StringBuffer();
	// StringBuffer를 통해서 sql 쿼리문을 붙여서 추가한다.
	sb.append(" select v.RESVNO                                                                 ")
    .append(" ,j.NAME                                                                       ")
    .append(" ,case substr(v.jumin, 8, 1)                                                   ")
    .append(" 	when '1' then '남'                                                          ")
    .append(" 	when '2' then '여'                                                          ")
    .append(" end as gender                                                                 ")
    .append(" ,case v.HOSPCODE                                                              ")
    .append(" 	when 'H001' then '가_병원'                                                    ")
    .append(" 	when 'H002' then '나_병원'                                                    ")
    .append(" 	when 'H003' then '다_병원'                                                    ")
    .append(" 	when 'H004' then '라_병원'                                                    ")
    .append(" end as hospcode                                                               ")
    .append(" ,to_char(v.RESVDATE,'yyyy\"년\"mm\"월\"dd\"일\"') as  RESVDATE                  ")
    .append(" ,substr(to_char(v.RESVTIME, 'FM0000'),1,2)                                      ")
    .append(" 	|| ':' || substr(to_char(v.RESVTIME, 'FM0000'),3,2) as RESVTIME               ")
    .append(" ,case VCODE                                                                     ")
    .append(" 	when 'V001' then 'A백신'                                                      ")
    .append(" 	when 'V002' then 'B백신'                                                      ")
    .append(" 	when 'V003' then 'C백신'                                                      ")
    .append(" end as vcode                                                                    ")
    .append(" ,case h.HOSPADDR                                                                ")
    .append(" 	when '10' then '서울'                                                         ")
    .append(" 	when '20' then '대전'                                                         ")
    .append(" 	when '30' then '대구'                                                         ")
    .append(" 	when '40' then '광주'                                                         ")
    .append(" end as HOSPADDR                                                                 ")
    .append(" from TBL_VACCRESV_202108 v, TBL_JUMIN_202108 j, TBL_HOSP_202108 h               ")
    .append(" where v.JUMIN = j.JUMIN and v.hospcode = h.hospcode                             ")
    .append(" and v.RESVNO =").append(reno);
	// sql을 쿼리문으로 지정한다.
	String sql = sb.toString();

	Connection conn = DBConnect.getConnection();
	PreparedStatement pstmt = conn.prepareStatement(sql);
	ResultSet rs = pstmt.executeQuery();
	
%>
<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href = "style.css?abc">
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<header>
<jsp:include page="header.jsp"></jsp:include>
</header>
<nav>
<jsp:include page="nav.jsp"></jsp:include>
</nav>
<section class = "section">
<%-- if문을 통해서 페이지에 조건을 입력한다. --%>
<% if(rs.next()){ %>
<h1>예약번호 <%= reno %>님의 예약 조회</h1>
<table class = "table">
<tr>
<td>예약번호</td><td>성명</td><td>성별</td><td>병원이름</td><td>예약날짜</td><td>예약시간</td><td>백신코드</td><td>병원지역</td>
</tr>
<tr>
<%-- 데이터에 첫번째 값부터 여덟번째 값까지 반환한다. --%>
<td><%= rs.getString(1) %></td>
<td><%= rs.getString(2) %></td>
<td><%= rs.getString(3) %></td>
<td><%= rs.getString(4) %></td>
<td><%= rs.getString(5) %></td>
<td><%= rs.getString(6) %></td>
<td><%= rs.getString(7) %></td>
<td><%= rs.getString(8) %></td>
</tr>
</table>
<%-- 조건이 참이면 예약 정보를 보여준다. --%>
<p align="center"><input type="button" value="돌아가기" onclick="location.href='vrj.jsp'"></p>
<%}else{ %>
<%-- 조건이 거짓이면 예약정보가 없다고 표기한다. --%>
<p align="center">예약번호 <%= reno %>번의 정보가 없습니다.</p>
<p align="center"><input type="button" value="홈으로"  onclick="location.href='index.jsp'"></p>
<%} %>

</section>
<footer>
<jsp:include page="footer.jsp"></jsp:include>
</footer>
</body>
</html>
```

이제 마지막으로 백신예약현황 페이지를 만듭니다.

![image](https://user-images.githubusercontent.com/104752580/234492494-a811da8c-19e3-4f1e-babf-f9d6a7dd7b75.png)

### 11. vrh.jsp

현황 페이지에서 접종예약건수와 병원지역 코드에 따른 지역명을 나타내기 위해서는 사칙연산 스크립틀릿 태그와 sql 쿼리문을 사용해야 합니다.

```jsp
<%@ page import="DB.DBConnect" %>
<%@ page import="java.sql.*" %>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%
	// 쿼리문을 조회한다.
	String sql = "select h.HOSPADDR, case h.hospaddr when '10' then '서울' when '20' then '대전' when '30' then '대구' when '40' then '광주' end as hosparea,count(v.HOSPCODE) from TBL_HOSP_202108 h, TBL_VACCRESV_202108 v where h.HOSPCODE = v.HOSPCODE(+) group by HOSPADDR order by HOSPADDR";

	Connection conn = DBConnect.getConnection();
	PreparedStatement pstmt = conn.prepareStatement(sql);
	ResultSet rs = pstmt.executeQuery();
	
	// sum을 0으로 지정해놓는다
	int sum = 0;


%>
<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href = "style.css?abc">
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<header>
<jsp:include page="header.jsp"></jsp:include>
</header>
<nav>
<jsp:include page="nav.jsp"></jsp:include>
</nav>
<section class = "section">
<h1>백신예약현황</h1>
<table class = "table">
<tr>
<td>병원지역</td><td>병원지역명</td><td>접종예약건수</td>
</tr>
<%-- 반복문을 사용하여 테이블 행,열 생성 --%>
<% while(rs.next()){ %>
<tr>
<td><%= rs.getString(1) %></td>
<td><%= rs.getString(2) %></td>
<td><%= rs.getString(3) %></td>
<%
// sum 값을 데이터의 3번째 값과 sum 값을 더한 값으로 지정한다.
sum += Integer.parseInt(rs.getString(3));
} %>
</tr>
<tr>
<td colspan="2" align="center">총합</td>
<%-- sum 값을 나타낸다. --%>
<td><%= sum %></td>
</table>
</section>
<footer>
<jsp:include page="footer.jsp"></jsp:include>
</footer>
</body>
</html>
```

모든 페이지를 완성했으면 시험지 문제대로 페이지가 완성되게끔 css를 작성해줍니다.

### 12. style.css

```css
@charset "UTF-8";

*{
	list-style: none;
	padding: 0;
	margin: 0;
}

.header{
	position:fixed;
	top: 0px;
	width: 100%;
	height: 80px;
	line-height: 80px;
	background-color: blue;
	text-align: center;
	color: white;
	font-size: 20pt;
}

.nav{
	position:fixed;
	top: 80px;
	width: 100%;
	height: 40px;
	line-height: 40px;
	background-color: rgb(128, 128, 255);
}

.nav ul li{
	float: left;
	padding: 0 15px;
}

.nav ul li a{
	text-decoration: none;
	color: white;
}

.section{
	position : fixed;
	top:120px;
	width: 100%;
	height:800px;
	background-color: #c0c0c0;
	overflow:auto;
	
}

.section h1{
	text-align: center;
	padding: 3px;
}

.footer{
	position:absolute;
	bottom : 0;
	width: 100%;
	height: 50px;
	line-height: 50px;
	background-color: blue;
	text-align: center;
	color: white;
	
}


.table{
	border: solid 1px black;
	border-collapse: collapse;
	margin: auto;
	overflow:auto;
}

.table tr td{
	border: solid 1px black;
	padding: 5px 20px;
} 

.table tr th{
	border: solid 1px black;
	padding: 5px 20px;
}
```
## 쿼리문 설명
### vr.jsp
```sql
select max(RESVNO) from TBL_VACCRESV_202108
```
백신예약 테이블에서 예약번호가 가장 큰 번호를 조회한다.

- max : 최대값을 불러드린다.
### vrj_p
```sql
select v.RESVNO
,j.NAME
,case substr(v.jumin, 8, 1)
	when '1' then '남'
	when '2' then '여'
end as gender
```
주민번호 8번째 자리가 1이면 남 2면 여 라고 나오게 조회 한다.

- case/when/then : when 조건을 만족할 때 then 조건을 반환함.  

- substr : 문자에서 몇번째부터 몇개 문자를 뽑아냄.

- as : 별칭(가명)
```sql
to_char(v.RESVDATE,'yyyy"년"mm"월"dd"일"') as  RESVDATE
```
날짜를 "2023년 04월 27일" 이런식으로 나타냄

- to_char : 날짜, 숫자 등의 값을 문자열로 변환함.

```sql
substr(to_char(v.RESVTIME, 'FM0000'),1,2) 
|| ':' || substr(to_char(v.RESVTIME, 'FM0000'),3,2) as RESVTIME
```
시간을 문자로 12:12 이런식으로 나타냄

- FM0000 : 숫자를 문자형으로 나타낼때 사용함
- || '' || : ''안에 들어가는 문자를 전에 데이터와 합친다.

```sql
from TBL_VACCRESV_202108 v, TBL_JUMIN_202108 j, TBL_HOSP_202108 h
where v.JUMIN = j.JUMIN and v.hospcode = h.hospcode and v.RESVNO ='20210001'
```
3개에 테이블을 join시켜 예약번호 20210001번에 대한 정보를 조회함

- join : 2개이상에 테이블을 연결하여 데이터를 조회한다.
### vrh.jsp
```sql
select h.HOSPADDR,
case h.hospaddr 
when '10' then '서울' 
when '20' then '대전' 
when '30' then '대구' 
when '40' then '광주' end as hosparea,
count(v.HOSPCODE) 
from TBL_HOSP_202108 h, TBL_VACCRESV_202108 v 
where h.HOSPCODE = v.HOSPCODE(+) 
group by HOSPADDR 
order by HOSPADDR
```
병원테이블과 백신예약테이블을 조인 시켜 병원주소가 10이면 서울, 20이면 대전, 30이면 대구, 40이면 광주가 나오게끔 하고

그 지역에 예약건수를 병원코드를 더한 후 병원 주소로 정렬하여 오름차순으로 조회한다.

- h.HOSPCODE = v.HOSPCODE(+) : h.HOSPCODE + v.HOSPCODE
- count : 데이터의 개수를 숫자로 나타냄
- group by : 특정 컬럼을 기준으로 집계한다.
- order by : 정렬 기준 (기본값과 asc는 오름차순, desc는 내림차순)

※ 집계 : 표 형식 데이터를 줄이고 요약하는 과정

## 작동
모든 페이지가 정상 작동하는지 검토합니다.
 
![image](https://user-images.githubusercontent.com/104752580/234508064-730cff0f-f088-471d-9928-3734cfcd944d.png)
![image](https://user-images.githubusercontent.com/104752580/234508121-31d1a8ea-b8e6-4250-842a-611c877846bd.png)
![image](https://user-images.githubusercontent.com/104752580/234508203-3877be36-80f8-4063-b30f-bb5a5cbbed86.png)
![image](https://user-images.githubusercontent.com/104752580/234508269-34198cdf-5318-4738-87eb-e96d16b1d94d.png)
![image](https://user-images.githubusercontent.com/104752580/234508345-e29283fe-a1c6-4d91-8745-51a329194e72.png)
![image](https://user-images.githubusercontent.com/104752580/234508393-10281f5a-7238-41b2-856c-6e4902963d9c.png)


